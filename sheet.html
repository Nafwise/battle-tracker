<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Akashic Records | Character Sheet</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0F172A">

    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        :root {
            --bg-deep: #020617;
            --bg-card: #1e293b;
            --accent: #d946ef; /* Fuchsia-500 */
            --accent-dim: #a21caf;
            --text-main: #F8FAFC;
            --text-muted: #94A3B8;
            --border: #334155;
        }

        body { 
            background-color: var(--bg-deep); 
            color: var(--text-main); 
            font-family: ui-sans-serif, system-ui, sans-serif;
            background-image: radial-gradient(circle at 50% 0%, #2e1065 0%, #020617 60%);
            min-height: 100vh;
        }

        /* Utility & scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
        
        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
        }

        input, textarea, select {
            background-color: #0f172a;
            border: 1px solid var(--border);
            color: white;
            border-radius: 0.375rem;
            transition: border-color 0.15s;
        }
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 1px var(--accent);
        }

        /* Stat Hexagon */
        .stat-hex {
            clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
        }

        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .tab-btn.active { background-color: var(--accent); color: white; }
        .tab-btn { background-color: transparent; color: var(--text-muted); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- ICONS ---
        const Icon = ({ children, className, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>
        );
        const User = (props) => <Icon {...props}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></Icon>;
        const Shield = (props) => <Icon {...props}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></Icon>;
        const Heart = (props) => <Icon {...props}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></Icon>;
        const Sword = (props) => <Icon {...props}><path d="m14.5 5.5-4 4"/><path d="m3 21 6.5-6.5"/><path d="m3 21 6.5-6.5"/><path d="M14.5 5.5l4-4a2 2 0 0 1 2.8 2.8l-4 4"/><path d="M11 2 2 11"/><path d="M16 7l5 5"/></Icon>;
        const Scroll = (props) => <Icon {...props}><path d="M19 17V5a2 2 0 0 0-2-2H4"/><path d="M8 21h12a2 2 0 0 0 2-2v-2H10v2a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v3h4"/></Icon>;
        const Backpack = (props) => <Icon {...props}><path d="M4 10a4 4 0 0 1 4-4h8a4 4 0 0 1 4 4v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2Z"/><path d="M9 6V4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2"/><path d="M8 21v-5a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v5"/><path d="M8 10h8"/><path d="M9 14h6"/></Icon>;
        const Home = (props) => <Icon {...props}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></Icon>;
        const Plus = (props) => <Icon {...props}><path d="M5 12h14"/><path d="M12 5v14"/></Icon>;
        const Trash2 = (props) => <Icon {...props}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></Icon>;
        const D20 = (props) => <Icon {...props}><path d="m12 2 10 5-10 5-10-5Z"/><path d="m2 7 10 10 10-10"/><path d="m2 17 10 5 10-5"/><path d="M12 22V12"/></Icon>;
        const FileText = (props) => <Icon {...props}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></Icon>;
        const Sparkles = (props) => <Icon {...props}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.276 1.276L3 12l5.813 1.912a2 2 0 0 1 1.276 1.276L12 21l1.912-5.813a2 2 0 0 1 1.276-1.276L21 12l-5.813-1.912a2 2 0 0 1-1.276-1.276Z"/></Icon>;
        const Zap = (props) => <Icon {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></Icon>;
        const Wand = (props) => <Icon {...props}><path d="M15 4V2"/><path d="M15 16v-2"/><path d="M8 9h2"/><path d="M20 9h2"/><path d="M17.8 11.8 19 13"/><path d="M10.6 6.4 9.4 5.2"/><path d="m19 5-1.2 1.2"/><path d="m9.4 12.8 1.2-1.2"/><path d="M2 21l9-9"/><path d="M22 3l-6 6"/></Icon>;
        const Skull = (props) => <Icon {...props}><circle cx="9" cy="12" r="1"/><circle cx="15" cy="12" r="1"/><path d="M8 20v2h8v-2"/><path d="m12.5 17-.5-1-.5 1h1z"/><path d="M16 20a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20"/></Icon>;
        const Circle = (props) => <Icon {...props}><circle cx="12" cy="12" r="10" /></Icon>;
        const CheckCircle = (props) => <Icon {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></Icon>;
        const Battery = (props) => <Icon {...props}><rect width="16" height="10" x="2" y="7" rx="2" ry="2"/><line x1="22" x2="22" y1="11" y2="13"/></Icon>;

        // --- CONSTANTS ---
        const DEFAULT_CHAR = {
            id: 'default',
            name: 'New Hero',
            class: 'Fighter',
            level: 1,
            race: 'Human',
            background: 'Soldier',
            xp: 0,
            inspiration: false,
            alignment: 'True Neutral',
            stats: { str: 10, dex: 10, con: 10, int: 10, wis: 10, cha: 10 },
            hp: { current: 10, max: 10, temp: 0, hitDiceCurrent: 1, hitDiceMax: 1 },
            deathSaves: { successes: 0, failures: 0 },
            ac: 10,
            speed: 30,
            initiative: 0,
            proficiencies: [], 
            otherProficiencies: "", 
            inventory: [],
            spells: [], 
            spellSlots: { 1:{total:0, used:0}, 2:{total:0, used:0}, 3:{total:0, used:0}, 4:{total:0, used:0}, 5:{total:0, used:0}, 6:{total:0, used:0}, 7:{total:0, used:0}, 8:{total:0, used:0}, 9:{total:0, used:0} },
            spellAbility: "int", 
            features: [], 
            attacks: [], 
            savingThrows: [], 
            resources: [], // { id, name, current, max }
            notes: "",
            coins: { cp: 0, sp: 0, ep: 0, gp: 0, pp: 0 }
        };

        const SKILLS = [
            { name: "Acrobatics", stat: "dex" }, { name: "Animal Handling", stat: "wis" }, { name: "Arcana", stat: "int" },
            { name: "Athletics", stat: "str" }, { name: "Deception", stat: "cha" }, { name: "History", stat: "int" },
            { name: "Insight", stat: "wis" }, { name: "Intimidation", stat: "cha" }, { name: "Investigation", stat: "int" },
            { name: "Medicine", stat: "wis" }, { name: "Nature", stat: "int" }, { name: "Perception", stat: "wis" },
            { name: "Performance", stat: "cha" }, { name: "Persuasion", stat: "cha" }, { name: "Religion", stat: "int" },
            { name: "Sleight of Hand", stat: "dex" }, { name: "Stealth", stat: "dex" }, { name: "Survival", stat: "wis" }
        ];

        // --- HELPERS ---
        const getMod = (score) => Math.floor((score - 10) / 2);
        const formatMod = (score) => { const m = getMod(score); return m >= 0 ? `+${m}` : `${m}`; };
        const getProficiency = (level) => Math.ceil(level / 4) + 1;

        // --- COMPONENTS ---

        const StatBox = ({ label, value, onChange, size = "md" }) => {
            const mod = formatMod(value);
            return (
                <div className="flex flex-col items-center">
                    <div className="text-xs uppercase font-bold text-slate-400 mb-1">{label}</div>
                    <div className="relative flex items-center justify-center">
                        <div className={`stat-hex bg-slate-800 border-2 border-fuchsia-900/50 ${size === "lg" ? "w-20 h-24" : "w-16 h-20"} flex flex-col items-center justify-center shadow-inner`}>
                            <span className="text-xl font-bold text-white z-10">{mod}</span>
                            <input 
                                type="number" 
                                value={value} 
                                onChange={(e) => onChange(parseInt(e.target.value) || 10)}
                                className="w-8 text-center bg-transparent border-0 text-[10px] text-slate-400 focus:ring-0 p-0 mt-1 z-10"
                            />
                        </div>
                    </div>
                </div>
            );
        };

        const SkillRow = ({ skill, char, onToggle }) => {
            const modVal = getMod(char.stats[skill.stat]);
            const isProf = char.proficiencies.includes(skill.name);
            const pb = getProficiency(char.level);
            const total = modVal + (isProf ? pb : 0);
            
            return (
                <div className="flex items-center justify-between text-sm py-1 border-b border-slate-800 hover:bg-slate-800/50 rounded px-1 group cursor-pointer" onClick={() => onToggle(skill.name)}>
                    <div className="flex items-center gap-2">
                        <div className={`w-3 h-3 rounded-full border ${isProf ? 'bg-fuchsia-500 border-fuchsia-500' : 'border-slate-600 group-hover:border-slate-400'}`} />
                        <span className="text-slate-300">{skill.name} <span className="text-[10px] text-slate-500 uppercase">({skill.stat})</span></span>
                    </div>
                    <span className={`font-mono font-bold ${total >= 0 ? 'text-fuchsia-300' : 'text-slate-400'}`}>{total >= 0 ? `+${total}` : total}</span>
                </div>
            );
        };

        function App() {
            const [characters, setCharacters] = useState(() => {
                const saved = localStorage.getItem('akashic_characters');
                return saved ? JSON.parse(saved) : [DEFAULT_CHAR];
            });
            const [activeId, setActiveId] = useState(() => characters[0]?.id || 'default');
            const [view, setView] = useState('sheet'); 
            const [activeTab, setActiveTab] = useState('main'); 
            
            const char = useMemo(() => characters.find(c => c.id === activeId) || DEFAULT_CHAR, [characters, activeId]);

            useEffect(() => {
                localStorage.setItem('akashic_characters', JSON.stringify(characters));
            }, [characters]);

            // --- ACTIONS ---
            const updateChar = (field, value) => setCharacters(prev => prev.map(c => c.id === activeId ? { ...c, [field]: value } : c));
            const updateStat = (stat, val) => setCharacters(prev => prev.map(c => c.id === activeId ? { ...c, stats: { ...c.stats, [stat]: val } } : c));
            const toggleProficiency = (skillName) => {
                const current = char.proficiencies;
                updateChar('proficiencies', current.includes(skillName) ? current.filter(p => p !== skillName) : [...current, skillName]);
            };
            const toggleSave = (stat) => {
                const current = char.savingThrows || [];
                updateChar('savingThrows', current.includes(stat) ? current.filter(s => s !== stat) : [...current, stat]);
            };
            const updateHP = (type, val) => updateChar('hp', { ...char.hp, [type]: val });
            const updateDeathSave = (type, val) => {
                const saves = char.deathSaves || { successes: 0, failures: 0 };
                updateChar('deathSaves', { ...saves, [type]: val });
            };
            
            const addItem = () => updateChar('inventory', [...char.inventory, { id: Date.now(), name: "New Item", qty: 1, notes: "" }]);
            const addSpell = () => updateChar('spells', [...char.spells, { id: Date.now(), name: "New Spell", level: 1, prepared: false, notes: "" }]);
            const addFeature = () => updateChar('features', [...char.features, { id: Date.now(), name: "New Feature", source: "Class", desc: "" }]);
            const addAttack = () => updateChar('attacks', [...char.attacks, { id: Date.now(), name: "Weapon", bonus: "+0", damage: "1d8", type: "Slashing" }]);
            const addResource = () => updateChar('resources', [...(char.resources||[]), { id: Date.now(), name: "Resource", current: 1, max: 1 }]);

            const updateItemInArray = (arrName, id, field, val) => {
                const newArr = (char[arrName] || []).map(i => i.id === id ? { ...i, [field]: val } : i);
                updateChar(arrName, newArr);
            };
            const deleteItemFromArray = (arrName, id) => updateChar(arrName, (char[arrName] || []).filter(i => i.id !== id));

            const createNewCharacter = () => {
                const newChar = { ...DEFAULT_CHAR, id: Date.now().toString(), name: "New Hero" };
                setCharacters([...characters, newChar]);
                setActiveId(newChar.id);
                setView('sheet');
            };
            
            const deleteCharacter = (id) => {
                if(!confirm("Delete this character?")) return;
                let newChars = characters.filter(c => c.id !== id);
                if (newChars.length === 0) {
                    const fresh = { ...DEFAULT_CHAR, id: Date.now().toString(), name: "New Hero" };
                    newChars = [fresh];
                }
                setCharacters(newChars);
                if (id === activeId || newChars.length === 1) { setActiveId(newChars[0].id); }
            };

            const pb = getProficiency(char.level);
            const spellMod = getMod(char.stats[char.spellAbility || 'int']);
            const spellAttack = spellMod + pb;
            const spellDC = 8 + spellMod + pb;

            // --- RENDER ---
            if (view === 'list') {
                return (
                    <div className="max-w-2xl mx-auto p-4 animate-fade-in pb-20">
                        <header className="flex items-center justify-between mb-6">
                            <h1 className="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-fuchsia-400 to-purple-400 flex items-center gap-2"><FileText className="text-fuchsia-500" /> Character Roster</h1>
                            <a href="./index.html" className="p-2 bg-slate-800 rounded-full text-slate-400 hover:text-white border border-slate-700 transition-colors"><Home size={20}/></a>
                        </header>
                        <div className="grid gap-3">
                            {characters.map(c => (
                                <div key={c.id} onClick={() => { setActiveId(c.id); setView('sheet'); }} className="glass-panel p-4 rounded-xl cursor-pointer hover:border-fuchsia-500 transition-colors flex justify-between items-center group">
                                    <div><div className="font-bold text-white text-lg">{c.name}</div><div className="text-sm text-slate-400">Lvl {c.level} {c.race} {c.class}</div></div>
                                    <div className="flex items-center gap-3"><span className="text-xs text-slate-500 bg-slate-900 px-2 py-1 rounded">HP: {c.hp?.current}/{c.hp?.max}</span><button onClick={(e) => { e.stopPropagation(); deleteCharacter(c.id); }} className="p-2 text-slate-600 hover:text-red-500"><Trash2 size={16}/></button></div>
                                </div>
                            ))}
                            <button onClick={createNewCharacter} className="p-4 rounded-xl border-2 border-dashed border-slate-700 text-slate-500 hover:border-fuchsia-500 hover:text-fuchsia-400 font-bold flex items-center justify-center gap-2 transition-all"><Plus size={20}/> Create New Character</button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen pb-20">
                    <div className="sticky top-0 z-50 bg-slate-900/90 backdrop-blur border-b border-slate-800 p-2 shadow-lg">
                        <div className="max-w-4xl mx-auto flex items-center justify-between gap-2">
                            <div className="flex items-center gap-2 flex-1">
                                <button onClick={() => setView('list')} className="p-2 bg-slate-800 rounded text-slate-300 hover:text-white border border-slate-700"><User size={18}/></button>
                                <input className="bg-transparent border-none text-lg font-bold text-white focus:ring-0 p-0 w-full truncate" value={char.name} onChange={(e) => updateChar('name', e.target.value)} />
                            </div>
                            <div className="flex items-center gap-2 shrink-0">
                                <div className="flex items-center gap-1 text-[10px] text-fuchsia-400 bg-fuchsia-950/30 px-2 py-1 rounded border border-fuchsia-900/50" title="Experience Points">
                                    <span>XP</span>
                                    <input type="number" className="w-12 bg-transparent border-0 text-center p-0 text-white font-bold focus:ring-0" value={char.xp} onChange={(e) => updateChar('xp', parseInt(e.target.value))} />
                                </div>
                                <div className="flex items-center gap-1 text-[10px] text-yellow-400 bg-yellow-950/30 px-2 py-1 rounded border border-yellow-900/50 cursor-pointer" onClick={() => updateChar('inspiration', !char.inspiration)} title="Inspiration">
                                    <span>Insp</span>
                                    <div className={`w-3 h-3 rounded-full border ${char.inspiration ? 'bg-yellow-500 border-yellow-500' : 'border-yellow-700'}`}></div>
                                </div>
                                <div className="flex items-center gap-1 text-xs font-mono text-fuchsia-400 bg-fuchsia-950/30 px-2 py-1 rounded border border-fuchsia-900/50">
                                    <span>LVL</span>
                                    <input type="number" className="w-6 bg-transparent border-0 text-center p-0 text-white font-bold focus:ring-0" value={char.level} onChange={(e) => updateChar('level', parseInt(e.target.value))} />
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="max-w-4xl mx-auto p-4 space-y-6 animate-fade-in">
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-2">
                            <input placeholder="Class" value={char.class} onChange={(e) => updateChar('class', e.target.value)} className="w-full text-xs" />
                            <input placeholder="Race" value={char.race} onChange={(e) => updateChar('race', e.target.value)} className="w-full text-xs" />
                            <input placeholder="Background" value={char.background} onChange={(e) => updateChar('background', e.target.value)} className="w-full text-xs" />
                            <input placeholder="Alignment" value={char.alignment} onChange={(e) => updateChar('alignment', e.target.value)} className="w-full text-xs" />
                        </div>

                        <div className="flex gap-2 border-b border-slate-700 pb-1 mb-4 overflow-x-auto">
                            {[ {id:'main', l:'Stats'}, {id:'combat', l:'Combat'}, {id:'magic', l:'Magic/Feats'}, {id:'bio', l:'Inventory'} ].map(t => (
                                <button key={t.id} onClick={() => setActiveTab(t.id)} className={`px-4 py-2 text-sm font-bold rounded-t-lg transition-colors ${activeTab === t.id ? 'bg-fuchsia-900/50 text-fuchsia-300 border-b-2 border-fuchsia-500' : 'text-slate-500 hover:text-slate-300'}`}>{t.l}</button>
                            ))}
                        </div>

                        {activeTab === 'main' && (
                            <div className="animate-fade-in space-y-4">
                                <div className="grid grid-cols-3 sm:grid-cols-6 gap-4 justify-items-center">
                                    {Object.keys(char.stats).map(stat => ( <StatBox key={stat} label={stat} value={char.stats[stat]} onChange={(v) => updateStat(stat, v)} /> ))}
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div className="glass-panel p-4 rounded-xl">
                                        <h3 className="font-bold text-slate-300 border-b border-slate-700 pb-2 mb-2">Skills</h3>
                                        <div className="space-y-1 max-h-80 overflow-y-auto">{SKILLS.map(skill => <SkillRow key={skill.name} skill={skill} char={char} onToggle={toggleProficiency} />)}</div>
                                    </div>
                                    <div className="glass-panel p-4 rounded-xl flex flex-col">
                                        <h3 className="font-bold text-slate-300 border-b border-slate-700 pb-2 mb-2">Proficiencies & Languages</h3>
                                        <textarea className="flex-1 w-full bg-slate-900/50 border-slate-700 p-3 rounded-lg text-sm text-slate-300 resize-none h-full" placeholder="Armor, Weapons, Tools, Languages..." value={char.otherProficiencies || ""} onChange={(e) => updateChar('otherProficiencies', e.target.value)}></textarea>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'combat' && (
                            <div className="animate-fade-in space-y-4">
                                <div className="grid grid-cols-3 gap-4">
                                    <div className="glass-panel p-2 rounded text-center"><Shield className="mx-auto mb-1 text-cyan-400"/><div className="text-xs uppercase text-slate-500 font-bold">AC</div><input type="number" className="w-full text-center text-xl font-bold bg-transparent border-none" value={char.ac} onChange={e=>updateChar('ac', parseInt(e.target.value))}/></div>
                                    <div className="glass-panel p-2 rounded text-center"><D20 className="mx-auto mb-1 text-yellow-400"/><div className="text-xs uppercase text-slate-500 font-bold">Init</div><input type="number" className="w-full text-center text-xl font-bold bg-transparent border-none" value={char.initiative} onChange={e=>updateChar('initiative', parseInt(e.target.value))}/></div>
                                    <div className="glass-panel p-2 rounded text-center"><Zap className="mx-auto mb-1 text-fuchsia-400"/><div className="text-xs uppercase text-slate-500 font-bold">Speed</div><input type="number" className="w-full text-center text-xl font-bold bg-transparent border-none" value={char.speed} onChange={e=>updateChar('speed', parseInt(e.target.value))}/></div>
                                </div>

                                <div className="glass-panel p-4 rounded-xl">
                                    <div className="flex justify-between border-b border-slate-700 pb-2 mb-2"><h3 className="font-bold text-slate-300 flex items-center gap-2"><Heart className="text-green-500" size={16}/> HP</h3><span className="text-xs text-slate-500">{char.level}d8 Hit Dice</span></div>
                                    <div className="flex gap-2 items-center mb-3">
                                        <div className="flex-1"><label className="text-[10px] text-slate-500 uppercase">Current</label><input type="number" className="w-full text-2xl font-bold text-center bg-slate-900 border-slate-700" value={char.hp.current} onChange={(e) => updateHP('current', parseInt(e.target.value))} /></div>
                                        <div className="flex-1"><label className="text-[10px] text-slate-500 uppercase">Max</label><input type="number" className="w-full text-2xl font-bold text-center bg-slate-900 border-slate-700 text-slate-400" value={char.hp.max} onChange={(e) => updateHP('max', parseInt(e.target.value))} /></div>
                                        <div className="flex-1"><label className="text-[10px] text-purple-400 uppercase">Temp</label><input type="number" className="w-full text-2xl font-bold text-center bg-purple-900/20 border-purple-800 text-purple-200" value={char.hp.temp} onChange={(e) => updateHP('temp', parseInt(e.target.value))} /></div>
                                    </div>
                                    
                                    <div className="flex gap-4">
                                        <div className="flex-1 bg-slate-900/50 p-2 rounded border border-slate-700 flex flex-col items-center">
                                            <span className="text-[10px] uppercase text-slate-500 font-bold mb-1">Hit Dice</span>
                                            <div className="flex items-center gap-2">
                                                <input type="number" className="w-8 text-center bg-transparent border-b border-slate-600 text-sm" value={char.hp.hitDiceCurrent || 0} onChange={e=>updateHP('hitDiceCurrent', parseInt(e.target.value))} />
                                                <span className="text-slate-500">/</span>
                                                <input type="number" className="w-8 text-center bg-transparent border-b border-slate-600 text-sm" value={char.hp.hitDiceMax || 0} onChange={e=>updateHP('hitDiceMax', parseInt(e.target.value))} />
                                            </div>
                                        </div>
                                        <div className="flex-1 bg-slate-900/50 p-2 rounded border border-slate-700 flex flex-col items-center justify-center">
                                            <span className="text-[10px] uppercase text-slate-500 font-bold mb-1">Death Saves</span>
                                            <div className="flex gap-4 text-xs">
                                                <div className="flex gap-1 items-center"><span className="text-green-500 font-bold">S</span>{[1,2,3].map(i=><div key={i} onClick={()=>updateDeathSave('successes', (char.deathSaves?.successes===i?i-1:i))} className={`w-3 h-3 rounded-full border border-green-600 cursor-pointer ${char.deathSaves?.successes>=i?'bg-green-600':''}`}></div>)}</div>
                                                <div className="flex gap-1 items-center"><span className="text-red-500 font-bold">F</span>{[1,2,3].map(i=><div key={i} onClick={()=>updateDeathSave('failures', (char.deathSaves?.failures===i?i-1:i))} className={`w-3 h-3 rounded-full border border-red-600 cursor-pointer ${char.deathSaves?.failures>=i?'bg-red-600':''}`}></div>)}</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div className="glass-panel p-4 rounded-xl">
                                    <h3 className="font-bold text-slate-300 border-b border-slate-700 pb-2 mb-2">Saving Throws</h3>
                                    <div className="grid grid-cols-2 md:grid-cols-3 gap-2">
                                        {['str','dex','con','int','wis','cha'].map(stat => {
                                            const mod = getMod(char.stats[stat]);
                                            const isProf = (char.savingThrows||[]).includes(stat);
                                            const total = mod + (isProf ? pb : 0);
                                            return (
                                                <div key={stat} onClick={() => toggleSave(stat)} className={`flex justify-between items-center p-2 rounded cursor-pointer border ${isProf ? 'bg-fuchsia-900/30 border-fuchsia-500' : 'bg-slate-900 border-slate-700'}`}>
                                                    <span className="uppercase text-xs font-bold text-slate-400">{stat}</span>
                                                    <span className={`font-mono font-bold ${total >= 0 ? 'text-green-400' : 'text-red-400'}`}>{total >= 0 ? `+${total}` : total}</span>
                                                </div>
                                            )
                                        })}
                                    </div>
                                </div>

                                <div className="glass-panel p-4 rounded-xl">
                                    <div className="flex justify-between items-center mb-3"><h3 className="font-bold text-slate-300 flex items-center gap-2"><Sword size={16}/> Attacks</h3><button onClick={addAttack} className="p-1 bg-slate-700 rounded hover:bg-slate-600 text-white"><Plus size={16}/></button></div>
                                    <div className="space-y-2">
                                        {(char.attacks||[]).map(att => (
                                            <div key={att.id} className="bg-slate-900/50 p-2 rounded border border-slate-700 grid grid-cols-12 gap-2 items-center">
                                                <input className="col-span-4 bg-transparent border-b border-slate-700 text-sm font-bold text-white placeholder-slate-600" value={att.name} onChange={e=>updateItemInArray('attacks', att.id, 'name', e.target.value)} placeholder="Weapon Name" />
                                                <input className="col-span-2 bg-transparent border-b border-slate-700 text-sm text-center text-green-400 placeholder-slate-600" value={att.bonus} onChange={e=>updateItemInArray('attacks', att.id, 'bonus', e.target.value)} placeholder="+5" />
                                                <input className="col-span-3 bg-transparent border-b border-slate-700 text-sm text-center text-yellow-400 placeholder-slate-600" value={att.damage} onChange={e=>updateItemInArray('attacks', att.id, 'damage', e.target.value)} placeholder="1d8+3" />
                                                <input className="col-span-2 bg-transparent border-b border-slate-700 text-[10px] text-slate-400 placeholder-slate-600" value={att.type} onChange={e=>updateItemInArray('attacks', att.id, 'type', e.target.value)} placeholder="Type" />
                                                <button onClick={() => deleteItemFromArray('attacks', att.id)} className="col-span-1 text-slate-600 hover:text-red-500"><Trash2 size={14}/></button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'magic' && (
                            <div className="animate-fade-in space-y-4">
                                <div className="glass-panel p-4 rounded-xl grid grid-cols-3 gap-4 text-center">
                                    <div><div className="text-[10px] text-slate-500 uppercase font-bold mb-1">Casting Stat</div><select className="w-full bg-slate-900 border-slate-700 text-xs text-center" value={char.spellAbility} onChange={e=>updateChar('spellAbility', e.target.value)}>{['int','wis','cha'].map(s=><option key={s} value={s}>{s.toUpperCase()}</option>)}</select></div>
                                    <div><div className="text-[10px] text-slate-500 uppercase font-bold mb-1">Save DC</div><div className="text-xl font-bold text-fuchsia-400">{spellDC}</div></div>
                                    <div><div className="text-[10px] text-slate-500 uppercase font-bold mb-1">Attack Mod</div><div className="text-xl font-bold text-green-400">+{spellAttack}</div></div>
                                </div>

                                <div className="glass-panel p-4 rounded-xl">
                                    <div className="flex justify-between items-center mb-3"><h3 className="font-bold text-slate-300 flex items-center gap-2"><Battery size={16} className="text-cyan-400"/> Resources</h3><button onClick={addResource} className="p-1 bg-slate-700 rounded hover:bg-slate-600 text-white"><Plus size={16}/></button></div>
                                    <div className="grid grid-cols-2 gap-2">
                                        {(char.resources||[]).map(res => (
                                            <div key={res.id} className="bg-slate-900/50 p-2 rounded border border-slate-700 flex items-center justify-between gap-2 group">
                                                <input className="bg-transparent border-none text-xs font-bold text-white w-full" value={res.name} onChange={e=>updateItemInArray('resources', res.id, 'name', e.target.value)} placeholder="Rage/Ki/Sorcery" />
                                                <div className="flex items-center gap-1">
                                                    <input type="number" className="w-6 text-center bg-transparent border-b border-slate-600 text-sm" value={res.current} onChange={e=>updateItemInArray('resources', res.id, 'current', parseInt(e.target.value))} />
                                                    <span className="text-slate-500 text-xs">/</span>
                                                    <input type="number" className="w-6 text-center bg-transparent border-b border-slate-600 text-sm text-slate-400" value={res.max} onChange={e=>updateItemInArray('resources', res.id, 'max', parseInt(e.target.value))} />
                                                </div>
                                                <button onClick={() => deleteItemFromArray('resources', res.id)} className="text-slate-600 hover:text-red-500 opacity-0 group-hover:opacity-100"><Trash2 size={12}/></button>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                <div className="glass-panel p-4 rounded-xl">
                                    <h3 className="font-bold text-slate-300 border-b border-slate-700 pb-2 mb-2">Spell Slots</h3>
                                    <div className="grid grid-cols-3 sm:grid-cols-9 gap-2">
                                        {[1,2,3,4,5,6,7,8,9].map(lvl => {
                                            const slot = (char.spellSlots && char.spellSlots[lvl]) || {total:0, used:0};
                                            return (
                                                <div key={lvl} className="bg-slate-900 p-1 rounded border border-slate-700 text-center">
                                                    <div className="text-[10px] text-slate-500 font-bold mb-1">{lvl}</div>
                                                    <div className="flex items-center justify-center gap-1">
                                                        <input type="number" className="w-5 text-center bg-transparent text-xs text-white p-0 border-none" value={slot.used} onChange={e => { const newSlots = {...char.spellSlots}; if(!newSlots[lvl]) newSlots[lvl] = {total:0, used:0}; newSlots[lvl].used = parseInt(e.target.value)||0; updateChar('spellSlots', newSlots); }} />
                                                        <span className="text-slate-600 text-xs">/</span>
                                                        <input type="number" className="w-5 text-center bg-transparent text-xs text-slate-400 p-0 border-none" value={slot.total} onChange={e => { const newSlots = {...char.spellSlots}; if(!newSlots[lvl]) newSlots[lvl] = {total:0, used:0}; newSlots[lvl].total = parseInt(e.target.value)||0; updateChar('spellSlots', newSlots); }} />
                                                    </div>
                                                </div>
                                            )
                                        })}
                                    </div>
                                </div>

                                <div className="glass-panel p-4 rounded-xl">
                                    <div className="flex justify-between items-center mb-3"><h3 className="font-bold text-slate-300 flex items-center gap-2"><Wand size={16} className="text-purple-400"/> Spells</h3><button onClick={addSpell} className="p-1 bg-slate-700 rounded hover:bg-slate-600 text-white"><Plus size={16}/></button></div>
                                    <div className="space-y-2">
                                        {(char.spells||[]).sort((a,b)=>a.level-b.level).map(spell => (
                                            <div key={spell.id} className="flex gap-2 items-center bg-slate-900/50 p-2 rounded border border-slate-700">
                                                <input type="number" className="w-6 bg-transparent text-center text-xs text-slate-500 border-none" value={spell.level} onChange={e=>updateItemInArray('spells', spell.id, 'level', parseInt(e.target.value))} placeholder="Lvl" />
                                                <input className="flex-1 bg-transparent border-none text-sm font-bold text-white placeholder-slate-600" value={spell.name} onChange={e=>updateItemInArray('spells', spell.id, 'name', e.target.value)} placeholder="Spell Name" />
                                                <button onClick={()=>updateItemInArray('spells', spell.id, 'prepared', !spell.prepared)} className={`text-[10px] px-2 py-0.5 rounded border ${spell.prepared ? 'bg-blue-900/50 border-blue-500 text-blue-300' : 'border-slate-600 text-slate-500'}`}>Prep</button>
                                                <button onClick={() => deleteItemFromArray('spells', spell.id)} className="text-slate-600 hover:text-red-500"><Trash2 size={14}/></button>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                <div className="glass-panel p-4 rounded-xl">
                                    <div className="flex justify-between items-center mb-3"><h3 className="font-bold text-slate-300 flex items-center gap-2"><Sparkles size={16} className="text-amber-400"/> Features & Traits</h3><button onClick={addFeature} className="p-1 bg-slate-700 rounded hover:bg-slate-600 text-white"><Plus size={16}/></button></div>
                                    <div className="space-y-2">
                                        {(char.features||[]).map(feat => (
                                            <div key={feat.id} className="bg-slate-900/50 p-3 rounded border border-slate-700 group">
                                                <div className="flex justify-between mb-1">
                                                    <input className="bg-transparent border-none text-sm font-bold text-white w-full placeholder-slate-500" value={feat.name} onChange={e=>updateItemInArray('features', feat.id, 'name', e.target.value)} placeholder="Feature Name" />
                                                    <button onClick={() => deleteItemFromArray('features', feat.id)} className="text-slate-600 hover:text-red-500 opacity-0 group-hover:opacity-100"><Trash2 size={14}/></button>
                                                </div>
                                                <textarea className="w-full bg-transparent border-none text-xs text-slate-400 resize-none h-auto p-0 placeholder-slate-600" rows="2" value={feat.desc} onChange={e=>updateItemInArray('features', feat.id, 'desc', e.target.value)} placeholder="Description..." />
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'bio' && (
                            <div className="animate-fade-in grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div className="glass-panel p-4 rounded-xl min-h-[300px] flex flex-col">
                                    <div className="flex justify-between items-center mb-3"><h3 className="font-bold text-slate-300 flex items-center gap-2"><Backpack size={16} className="text-amber-500"/> Inventory</h3><button onClick={addItem} className="p-1 bg-slate-700 rounded hover:bg-slate-600 text-white"><Plus size={16}/></button></div>
                                    <div className="flex-1 space-y-2 overflow-y-auto max-h-96 pr-1">
                                        {char.inventory.map(item => (
                                            <div key={item.id} className="flex gap-2 items-start bg-slate-900/50 p-2 rounded group">
                                                <input className="w-8 text-center bg-transparent border-b border-slate-700 text-xs focus:bg-slate-800" value={item.qty} onChange={(e) => updateInventory(item.id, 'qty', e.target.value)} />
                                                <div className="flex-1">
                                                    <input className="w-full bg-transparent border-none p-0 text-sm font-bold text-slate-200 focus:ring-0 placeholder-slate-600" value={item.name} onChange={(e) => updateInventory(item.id, 'name', e.target.value)} placeholder="Item Name" />
                                                    <textarea className="w-full bg-transparent border-none p-0 text-[10px] text-slate-400 focus:ring-0 resize-none h-auto" rows="1" value={item.notes} onChange={(e) => updateInventory(item.id, 'notes', e.target.value)} placeholder="Notes..." />
                                                </div>
                                                <button onClick={() => deleteItem(item.id)} className="text-slate-600 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity"><Trash2 size={14}/></button>
                                            </div>
                                        ))}
                                    </div>
                                    <div className="grid grid-cols-5 gap-2 mt-4 pt-3 border-t border-slate-700">
                                        {['cp','sp','ep','gp','pp'].map(curr => ( <div key={curr} className="flex flex-col items-center"><span className="text-[10px] uppercase text-slate-500 font-bold">{curr}</span><input type="number" className="w-full text-center text-xs bg-slate-900 border-slate-700 p-1" value={char.coins[curr]} onChange={(e) => updateChar('coins', {...char.coins, [curr]: parseInt(e.target.value)})} /></div> ))}
                                    </div>
                                </div>
                                <div className="glass-panel p-4 rounded-xl flex flex-col">
                                    <h3 className="font-bold text-slate-300 flex items-center gap-2 mb-3"><Scroll size={16} className="text-indigo-400"/> Notes & Bio</h3>
                                    <textarea className="flex-1 w-full bg-slate-900/50 border-slate-700 p-3 rounded-lg text-sm text-slate-300 leading-relaxed resize-none focus:bg-slate-900 transition-colors" placeholder="Character backstory, session notes, or active quests..." value={char.notes} onChange={(e) => updateChar('notes', e.target.value)} style={{minHeight: '300px'}}></textarea>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>